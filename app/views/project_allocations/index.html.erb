<% content_for :head do %>
  <%= render(:partial => "shared/import_tablesorter") %>
  <script type="text/javascript">
    $(document).ready(function() {
      $("#projects")
      .tablesorter({sortList: [[0, 0]], widthFixed: true, widgets: ['zebra']})
      .tablesorterPager({container: $("#pager"), positionFixed: false});
    });
  </script>
<% end %>

<% title "Project allocations" %>

<p>As of selection/allocation round <%= @allocation_round %></p>

<table id="projects" class="tablesorter">
<thead>
<tr>
  <th>#</th>
  <th>Project</th>
  <td>Student</th>
  <th>Supervisor</th>
  <th>Round</th>
  <% if current_user.has_role?("coordinator") %>
    <th colspan="3">Actions</a>
  <% end %>
</tr>
</thead>

<% @project_allocations.each do |project_allocation| %>
<%
  student = Student.find(project_allocation.student_id)
  project = Project.find(project_allocation.project_id)
  supervisor = Supervisor.find(project_allocation.supervisor_id)
%>
  <tr class="<%=  cycle('odd', 'even') %>">
    <td><%= project.id %></td>
    <td><%= link_to "#{h(project.title)}", project_path(project.id) %></td>
    <td><%= h(student.student_id) %></td>
    <td><%=  h(supervisor.name) %></td>
    <td><%=  h(project_allocation.allocation_round) %></td>
    <% if current_user.has_role?("coordinator") %>
      <td><%= link_to 'Show', project_allocation %></td>
      <td><%= link_to 'Edit', edit_project_allocation_path(project_allocation) %></td>
      <td><%= link_to 'Destroy', project_allocation, :confirm => 'Are you sure?', :method => :delete %></td>
    <% end %>
  </tr>
<% end %>
</table>
<%= render(:partial => "shared/tablesorter_pager", :locals => {:pager_id => 'pager'})%>

<p>
  <%  if current_user.has_role?("coordinator") %>
    <%= link_to 'New project_allocation', new_project_allocation_path %>
  <%  end %>
</p>